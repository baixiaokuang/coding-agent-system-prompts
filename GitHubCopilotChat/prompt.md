## Copilot Chat Agent Prompts

- **Registry & assembly**: `src/extension/prompts/node/agent/promptRegistry.ts` maps model families to prompt resolvers. `agentPrompt.tsx` builds each request with the model’s system prompt, optional copilot identity/safety rules, custom instructions, conversation history (`agentConversationHistory.tsx`), and the latest user message/tool calls. Codesearch mode and cache-breakpoint summarization use the same machinery.
- **Shared building blocks**: `defaultAgentInstructions.tsx` supplies the baseline system prompt (tool use rules, edit instructions, notebook guidance, code-search rules via `CodesearchModeInstructions`, and Markdown/linkification defaults). It also defines reminder snippets, MCP tool instruction rendering, and apply-patch guidance. `fileLinkificationInstructions.tsx` enforces strict link formatting (no backticks around file paths/lines). `ResponseTranslationRules`, `MathIntegrationRules`, and `CodeBlockFormattingRules` are imported into most prompts.
- **History compression**: `summarizedConversationHistory.tsx` drives the main summarizer with a verbose analysis/summary template focused on recent tool calls; `simpleSummarizedHistoryPrompt.tsx` is the fallback that keeps the first user message, truncates tool calls, and optionally re-injects the “keep going” reminder for GPT‑4.1.
- **CLI user prompt shaping**: `copilotCLIPrompt.tsx` rewrites each CLI user message, adds `<attachments>` for resolved variables/paths (with summaries for untitled/prompt files), includes edited-file context, and emits `user_query` instead of `userRequest` for Grok-code endpoints.
- **Prompt bundle export**: `allAgentPrompts.ts` simply imports all model-specific prompt modules so they self-register.

## Model-Specific System Prompts

- **OpenAI default** (`openai/defaultOpenAIPrompt.tsx`): baseline “keep going” agent instructions plus standard tool/edit/Markdown rules and optional attachment hint for GPT‑4.1. Reminder reiterates persistence and edit-tool preferences.
- **GPT‑5 family** (`openai/gpt5Prompt.tsx`): richer personality (concise/friendly), mandatory preambles before tool calls, detailed planning guidance, ambition vs precision rules, and strong final-answer formatting. Enforces tool prioritization (apply_patch/replace_string), coding guidelines, and proactive testing philosophy. Adds a tool reference hint that nudges starting with user-attached tools.
- **GPT‑5.1 family** (`openai/gpt51Prompt.tsx`): similar to GPT‑5 but with stronger autonomy/persistence, frequent short status updates, explicit planning rules, and warnings against re-reading after apply_patch. Requires preambles before tool batches and progress updates after several tool calls. Reminder repeats persistence and edit-tool preferences.
- **GPT‑5 Codex** (`openai/gpt5CodexPrompt.tsx`): slimmed Codex-style instructions mirroring the developer coding agent guidelines (ASCII preference, minimal comments, avoid reverting user changes, optional TODO tool, concise final-answer style).
- **GPT‑5.1 Codex / Arctic Fox** (`openai/gpt51CodexPrompt.tsx`): Codex-style but with extra constraints—maximize parallel file reads via `multi_tool_use.parallel`, strong front-end design rules, dirty-worktree safety rules, and detailed formatting/next-step expectations.
- **Hidden Model B** (`openai/hiddenModelBPrompt.tsx`): GPT‑5.1-like autonomy plus design/scope constraints (don’t add UX beyond spec), long-context handling steps, ambiguity handling/clarifications, and a high-risk self-check section. Reminder matches GPT‑5.1’s persistence and editing tips.
- **Anthropic** (`anthropicPrompts.tsx`): default prompt mirrors baseline agent rules; `Claude45DefaultPrompt` adds stronger autonomy (“implement by default”), workflow guidance for parallel discovery, and strict brevity/communication examples. Reminder adds the standard edit hint plus “do not create markdown summaries of changes.”
- **Gemini** (`geminiPrompts.tsx`): same as the default agent prompt but reminder forces a strong preference for replace-string edits before editFile.
- **xAI Grok-code** (`xAIPrompts.tsx`): default instructions plus validation mandate—run relevant builds/tests after substantive changes, iterate up to three times on failures, prefer minimal dependencies, and supply full deliverables (runner/test harness/README/manifest) for non-trivial generation. User query is pulled from `<user_query>`. Edit instructions emphasize batching multi-edit tool calls when available.
- **VS Code first-party models** (`vscModelPrompts.tsx`):
  - *Model A*: heavy guidance on when/how to use the todo-list tool, detailed final-answer Markdown+emoji styling, and strict “preamble” cadence for all commentary-channel text.
  - *Model B*: even stricter—single-turn expectation, mandatory test execution whenever code is shown/edited (must discover and run project tests), and concise conversational tone. Final-answer formatting similar to A; reminder enforces preamble + status discipline.

## Other Notable Prompts

- **Conversation history rendering**: `agentConversationHistory.tsx` (plus `summarizedConversationHistory.tsx`) controls how prior turns/tool calls are injected, with token caps on tool results (`MAX_TOOL_RESPONSE_PCT` in `agentPrompt.tsx`).
- **Alternate GPT prompt**: `defaultAgentInstructions.tsx` includes `AlternateGPTPrompt`, an experimental GPT-specific workflow that mandates recursive web fetching via `fetch_web_page`, aggressive planning, 2k-line pre-read guidance, and proactive .env creation with placeholders when env vars are needed.
- **Reminder hooks**: Each resolver supplies a `ReminderInstructions` class (e.g., Gemini strong replace-string hint, Anthropic no-markdown-summary, VSCModel reminder to follow preamble rules) returned by `resolveReminderInstructions` in the relevant prompt resolver.
